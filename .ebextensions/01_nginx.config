
option_settings:
  aws:elasticbeanstalk:environment:proxy:
    ProxyServer: nginx
  aws:elasticbeanstalk:application:environment:
    PORT: 8080

files:
  "/etc/nginx/nginx.conf":
    mode: "000644"
    owner: root
    group: root
    content: |
      http {
        server_tokens off;

        include        /etc/nginx/mime.types;
        types_hash_max_size 8192;  # Ajusta este valor si la advertencia persiste (prueba con 16384)
        types_hash_bucket_size 1024; # Ajusta este valor si la advertencia persiste (prueba con 2048)

        default_type   application/octet-stream;

        log_format main '$remote_addr - $remote_user [$time_local] "$request" '
                        '$status $body_bytes_sent "$http_referer" '
                        '"$http_user_agent" "$http_x_forwarded_for"';

        include        conf.d/*.conf;

        map $http_upgrade $connection_upgrade {
          default "upgrade";
        }
      }
  "/etc/nginx/conf.d/proxy.conf":
    mode: "000644"
    owner: root
    group: root
    content: |
      client_max_body_size 10M;
      proxy_connect_timeout 600;
      proxy_send_timeout 600;
      proxy_read_timeout 600;
      send_timeout 600;
  "/etc/nginx/conf.d/elasticbeanstalk/00_application.conf":
    mode: "000644"
    owner: root
    group: root
    content: |
      # location / {  <-- Bloque location / comentado
      #   proxy_pass         http://127.0.0.1:8080;
      #   proxy_http_version 1.1;
      #   proxy_set_header   Connection             $connection_upgrade;
      #   proxy_set_header   Upgrade                $http_upgrade;
      #   proxy_set_header   Host                   $host;
      #   proxy_set_header   X-Real-IP              $remote_addr;
      #   proxy_set_header   X-Forwarded-For        $proxy_add_x_forwarded_for;
      # }

commands:
  01_reload_nginx:
    command: "sudo systemctl reload nginx"